# H2 Purification Train Topology based on User Request
# Sequence: H2Source -> KOD1 -> DryCooler1 -> Chiller1 -> KOD2 -> Coalescer1 -> HeatExchanger1 -> Deoxo1 -> PSA1

nodes:
  # === H2 Source (Simulating SOEC output) ===
  - id: "H2_Source"
    type: "H2Source"
    params:
      mass_flow_kg_h: 93.3
      pressure_bar: 40.0
      temperature_c: 60.0
      h2_purity: 0.9417
      o2_impurity: 0.00316
      h2o_impurity: 0.0549
    connections:
      - source_port: "h2_out"
        target_name: "KOD1"
        target_port: "gas_inlet"
        resource_type: "gas"

  # === 1. KOD1 (KnockOutDrum) ===
  - id: "KOD1"
    type: "KnockOutDrum"
    params:
      diameter_m: 1.0
      delta_p_bar: 0.05
      gas_species: "H2"
    connections:
      - source_port: "gas_outlet"
        target_name: "DryCooler1"
        target_port: "fluid_in"
        resource_type: "gas"

  # === 2. DryCooler1 (DryCooler) ===
  - id: "DryCooler1"
    type: "DryCooler"
    params:
      component_id: "DryCooler1"
    connections:
      - source_port: "fluid_out"
        target_name: "Chiller1"
        target_port: "fluid_in"
        resource_type: "stream"

  # === 3. Chiller1 (Chiller) ===
  - id: "Chiller1"
    type: "Chiller"
    params:
      target_temp_k: 278.15  # 5Â°C per Key Parameters Table
      cooling_capacity_kw: 100.0
      cop: 4.0
      pressure_drop_bar: 0.2
    connections:
      - source_port: "fluid_out"
        target_name: "KOD2"
        target_port: "gas_inlet"
        resource_type: "stream"

  # === 4. KOD2 (KnockOutDrum) ===
  - id: "KOD2"
    type: "KnockOutDrum"
    params:
      diameter_m: 1.0
      delta_p_bar: 0.05
      gas_species: "H2"
    connections:
      - source_port: "gas_outlet"
        target_name: "Coalescer1"
        target_port: "inlet"
        resource_type: "gas"

  # === 5. Coalescer1 (Coalescer) ===
  - id: "Coalescer1"
    type: "Coalescer"
    params:
      component_id: "Coalescer1"
      gas_type: "H2"
    connections:
      - source_port: "outlet"
        target_name: "HeatExchanger1"
        target_port: "h2_in"
        resource_type: "gas"

  # === 6. HeatExchanger1 (HeatExchanger) ===
  - id: "HeatExchanger1"
    type: "HeatExchanger"
    params:
      max_heat_removal_kw: 50.0  # per Key Parameters Table
      target_outlet_temp_c: 40.0 # per Key Parameters Table
    connections:
      - source_port: "h2_out"
        target_name: "Deoxo1"
        target_port: "inlet"
        resource_type: "gas"

  # === 7. Deoxo1 (DeoxoReactor) ===
  - id: "Deoxo1"
    type: "DeoxoReactor"
    params: {}
    connections:
      - source_port: "outlet"
        target_name: "PSA1"
        target_port: "gas_in"
        resource_type: "gas"

  # === 8. PSA1 (PSA Unit) ===
  - id: "PSA1"
    type: "PSA Unit"
    params: {}
    connections: []
