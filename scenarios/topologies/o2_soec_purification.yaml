# SOEC Oxygen Purification Train Topology based on User Request
# Sequence: O2Source -> KOD1 -> DryCooler1 -> Chiller1 -> KOD2 -> Coalescer1

nodes:
  # === O2 Source (Simulating SOEC Oxygen output) ===
  - id: "O2_Source"
    type: "ExternalOxygenSource"
    params:
      mass_flow_kg_h: 746.4  # Mass ratio O2/H2 = 8:1
      pressure_bar: 1.5      # SOEC typically low pressure
      temperature_c: 600.0   # Hot gas from SOEC
      o2_purity: 0.95        # Steam mixed
      h2o_impurity: 0.05
    connections:
      - source_port: "o2_out"
        target_name: "KOD1"
        target_port: "gas_inlet"
        resource_type: "gas"

  # === 1. KOD1 (KnockOutDrum) ===
  # "Bulk liquid water separator"
  - id: "KOD1"
    type: "KnockOutDrum"
    params:
      diameter_m: 0.5        # Requested
      delta_p_bar: 0.05      # Requested
      gas_species: "O2"      # Requested
    connections:
      - source_port: "gas_outlet"
        target_name: "DryCooler1"
        target_port: "fluid_in"
        resource_type: "gas"

  # === 2. DryCooler1 (DryCooler) ===
  # "Initial air-cooled cooling of two-phase stream"
  - id: "DryCooler1"
    type: "DryCooler"
    params:
      component_id: "DryCooler1"
    connections:
      - source_port: "fluid_out"
        target_name: "Chiller1"
        target_port: "fluid_in"
        resource_type: "stream"

  # === 3. Chiller1 (Chiller) ===
  # "Deep cooling/condensation to ~4°C"
  - id: "Chiller1"
    type: "Chiller"
    params:
      target_temp_k: 277.15  # Requested (4°C)
      cooling_capacity_kw: 200.0 # Increased for O2 flow
      cop: 4.0
      pressure_drop_bar: 0.2
    connections:
      - source_port: "fluid_out"
        target_name: "KOD2"
        target_port: "gas_inlet"
        resource_type: "stream"

  # === 4. KOD2 (KnockOutDrum) ===
  # "Post-chill water knockout"
  - id: "KOD2"
    type: "KnockOutDrum"
    params:
      diameter_m: 0.5        # Assuming same as KOD1 unless specified
      delta_p_bar: 0.05
      gas_species: "O2"      # Requested
    connections:
      - source_port: "gas_outlet"
        target_name: "Coalescer1"
        target_port: "inlet"
        resource_type: "gas"

  # === 5. Coalescer1 (Coalescer) ===
  # "Final mist eliminator"
  - id: "Coalescer1"
    type: "Coalescer"
    params:
      component_id: "Coalescer1"
      gas_type: "O2"         # Important for properties
    connections: []
